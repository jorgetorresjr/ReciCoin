<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Painel do Ponto - ReciCoin</title>
    <link rel="stylesheet" th:href="@{/css/custom.css}">
</head>
<body>

    <nav style="background: white; padding: 15px; display: flex; justify-content: space-between;">
        <h2 style="color: #2E7D32;">Painel do Parceiro</h2>
        <button onclick="logout()" class="btn btn-secondary">Sair</button>
    </nav>

    <div class="container" style="margin-top: 40px;">
        <h1>Agendamentos Recebidos</h1>
        
        <div class="clean-card">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="text-align: left; border-bottom: 2px solid #eee;">
                        <th style="padding: 10px;">Data/Hora</th>
                        <th style="padding: 10px;">Usu√°rio</th>
                        <th style="padding: 10px;">Status</th>
                    </tr>
                </thead>
                <tbody id="listaAgendamentos">
                    </tbody>
            </table>
            <p id="msgVazio" class="text-center" style="margin-top:20px; display:none;">Nenhum agendamento encontrado.</p>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('token');
        if (!token) window.location.href = '/login';

        function logout() { localStorage.removeItem('token'); window.location.href = '/login'; }

        async function carregarDashboard() {
            try {
                const response = await fetch('/appointments/my-schedule', {
                    method: 'GET',
                    headers: { 'Authorization': 'Bearer ' + token }
                });

                if(response.ok) {
                    const lista = await response.json();
                    const tbody = document.getElementById('listaAgendamentos');
                    
                    if (lista.length === 0) {
                        document.getElementById('msgVazio').style.display = 'block';
                        return;
                    }

                    lista.forEach(item => {
                        const dataObj = new Date(item.scheduledDate);
                        const dataFormatada = dataObj.toLocaleString('pt-BR');

                        tbody.innerHTML += `
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 15px;">${dataFormatada}</td>
                                <td style="padding: 15px;">${item.user ? item.user.name : 'Desconhecido'}</td>
                                <td style="padding: 15px;">
                                    <span style="background: #e8f5e9; color: green; padding: 5px 10px; border-radius: 15px;">${item.status}</span>
                                </td>
                            </tr>
                        `;
                    });
                }
            } catch (e) { console.error(e); }
        }

        carregarDashboard();
    </script>
</body>
</html>